// ----------------------------------------------------------------------
// Helper: notify admin when a request is submitted (non-blocking)
// ----------------------------------------------------------------------
private void function sendAdminSubmitNotice(
  required string createdByVal,
  required struct payload,
  required struct result
) output="false" {

  var adminEmail = "nabin.timsina@usps.gov";
  if ( !len(trim(adminEmail)) ) return;

  // Optional facility display name
  var facilityName = "";
  try {
    var qFac = queryExecute(
      "
        SELECT TOP 1 B_FIN_NAME
        FROM PCSV_dw.dbo.var_base WITH (NOLOCK)
        WHERE B_FIN_NBR = :fin
      ",
      { fin: { value = arguments.payload.facility, cfsqltype = "cf_sql_varchar" } },
      { datasource = "pcsv_dw" }
    );
    if ( qFac.recordCount ) facilityName = qFac.B_FIN_NAME[1];
  } catch (any __facErr) {
    // ignore
  }

  var reqId = arguments.result.REQUESTID;
  var subj  = "New Flex Time request submitted (ID " & reqId & ")";

  // Build HTML
  var facLine = htmlEditFormat( toString(arguments.payload.facility & "") );
  if ( len(trim(facilityName)) ) {
    facLine = facLine & " - " & htmlEditFormat(facilityName);
  }

  var html = "";
  html = html & "<div style='font-family:Segoe UI,Arial,sans-serif; font-size:14px; color:#111827'>";
  html = html & "<p><b>A new Flex Time request was submitted.</b></p>";
  html = html & "<p>";
  html = html & "<b>Request ID:</b> " & htmlEditFormat(reqId & "") & "<br>";
  html = html & "<b>Submitted By (ACE):</b> " & htmlEditFormat(arguments.createdByVal & "") & "<br>";
  html = html & "<b>Facility:</b> " & facLine & "<br>";
  html = html & "<b>Craft:</b> " & htmlEditFormat(arguments.payload.craft & "") & "<br>";
  html = html & "<b>LDC:</b> " & htmlEditFormat(arguments.payload.operation & "") & "<br>";
  html = html & "<b>Operation:</b> " & htmlEditFormat(arguments.payload.operationCode & "") & "<br>";
  html = html & "<b>Hours/Week:</b> " & htmlEditFormat(arguments.payload.hours & "") & "<br>";
  html = html & "<b>Weeks:</b> " & htmlEditFormat(arguments.payload.wk_start & "") & " to " & htmlEditFormat(arguments.payload.wk_end & "");
  html = html & "</p>";

  if ( len(trim(arguments.payload.justification & "")) ) {
    html = html & "<p><b>Justification:</b><br>" & htmlEditFormat(arguments.payload.justification & "") & "</p>";
  }

  html = html & "<p><a href='https://eagnmnwbp161f.usps.gov/ref/toolbox/flex/admin.html'>Open Admin Dashboard</a></p>";
  html = html & "</div>";

  // Send via your existing mail component
  try {
    var mailer = createObject("component", "ref.api.v1.toolbox.flex.flexmail").init();
    mailer.sendHtml(
      toEmail = adminEmail,
      subject = subj,
      html    = html
    );
  } catch (any __sendErr) {
    writeLog(
      file="application",
      text="sendAdminSubmitNotice mail exception id=" & reqId & " :: " & __sendErr.message & " :: " & __sendErr.detail
    );
  }
}
